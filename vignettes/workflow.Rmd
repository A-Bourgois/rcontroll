---
title: "Simulation workflow"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Simulation workflow}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Simulations

## Data

```{r datasim}
library(rcontroll)
data("TROLLv3_input")
data("TROLLv3_species")
data("TROLLv3_climatedaytime12")
data("TROLLv3_climatedaytime365")
data("TROLLv3_daytimevar")
TROLLv3_input$value[5] <- 10 # iterations
```

## Full

```{r fullsim}
sim <- troll(name = "test",
             # path = "./",
             full = TRUE,
             abc = FALSE, 
             random = TRUE,
             global = TROLLv3_input,
             species = TROLLv3_species,
             climate = TROLLv3_climatedaytime12,
             daily = TROLLv3_daytimevar)
sim
```

```{r fullsimG1}
autoplot(sim, 
         what = "ecosystem", 
         variables = c("abund", "agb"), 
         species = "total")
```

```{r fullsimG2}
autoplot(sim, what = "final pattern")
```

## Reduced

```{r reducedsim}
sim <- troll(name = "test",
             # path = "./",
             full = FALSE,
             abc = FALSE, 
             random = TRUE,
             global = TROLLv3_input,
             species = TROLLv3_species,
             climate = TROLLv3_climatedaytime12,
             daily = TROLLv3_daytimevar)
sim
```

```{r reducedsimG1}
autoplot(sim, 
         what = "ecosystem", 
         variables = c("N", "AGB"), 
         species = "total")
```

```{r reducedsimG2}
autoplot(sim, what = "final pattern")
```

# Stacks

## Data

```{r datasim}
library(rcontroll)
data("TROLLv3_input")
data("TROLLv3_species")
data("TROLLv3_climatedaytime12")
data("TROLLv3_climatedaytime365")
data("TROLLv3_daytimevar")
TROLLv3_input$value[5] <- 10 # iterations
TROLLv3_input_stack <- TROLLv3_input %>% 
  mutate(simulation = list(c("seed50000", "seed500"))) %>% 
  unnest(simulation)
TROLLv3_input_stack[62,2] <- 500 # Cseedrain
```

## Full

```{r fullstack}
sim <- stack(name = "test",
             c("seed50000", "seed500"),
             # path = "./",
             full = TRUE,
             abc = FALSE,
             random = TRUE,
             global = TROLLv3_input_stack,
             species = TROLLv3_species,
             climate = TROLLv3_climatedaytime12,
             daily = TROLLv3_daytimevar)
sim
```
## Reduced
