---
title: "Developers guidelines"
author: Sylvain Schmitt sylvain.schmitt@agroparistech.fr
date: '`r Sys.Date()`'
output:
  bookdown::html_document2:
    number_sections: false
    toc: true
    toc_float: yes
---

![](https://img.shields.io/badge/stability-work_in_progress-lightgrey.svg)

# Introduction

This document aim to give guidelines for all users interested in partipating to the development of `RconTROLL` for both core development or development associated to additional specific modules of `TROLL`. This document is a work in progress and everybody is invited to participate to its writting using subsequent guidelines. Part of the document is inpired from [R packges book by Hadley Wickham](http://r-pkgs.had.co.nz/) and [GitHub help](https://help.github.com/), which I recommand to read too.

*NB: Those guidelines might be sometimes specific to `RconTROLL` and may differ for other R packages.*

# Package structure

`RconTROLL` R package has the following structure:

* **Root files**
    + `README.md` package markdown description
    + `NEWS.md` news tracking in markdown (see [Version tracking])
    + `DESCRIPTION` R package description
    + `NAMESPACE` R package namespace
    + `cran-comment.md` CRAN submission file
    + `.travis.yml`, `appveyor.yml` continuous integration files (see [Social coding with GitHub])
    + `RconTROLL.Rproj` R project
    + `.gitignore`, `.Rbuildignore` files to be ignored bit Git and Rbuild
    + `.Rproj.user`, `.Rhistory`, `.RData`, `.Ruserdata` R project files
* **`R` folder**: include all R code with one file per function, class, method, data, and package (see [Writting R code in `RconTROLL`]). Cannot include subfolders !
* **`man` folder**: include all package documentation in Rd automatically built with R files (do not edit by hand, see [Documenting])
* **`inst/extdata` folder**: include raw data from the package used for examples (init, species, climate, inventory)
* **`tests` folder**: include formal tests (see [Formal testing])
* **`vignettes` folder**: include pacakges vignettes for users
* **`dev` folder**: include developers tools and documentation (including the present document)

# Basic workflow

Development should follow the following workflow:

1. Code writting in R
1. Documenting
1. Formal testing and checking
1. Repeat previous steps until happy
1. NEWS editing, comit and push
1. And when ready, sharing

# Writting R code in `RconTROLL`

For the moment code writting does not include much rules. Noticeable rules are listed below, feel free to submit others:

* functions names and variables names (not mandatory for variables) follow [camel case](https://en.wikipedia.org/wiki/Camel_case) writting
* functions names always start in lowercase whereas class names start in uppercase
* R files have the name of the object they include (i.e. `function.R`, `CLASS.R`)
* R files for methods include the class name after a dot before the .R (i.e. `method.CLASS.R`)
* try to minimise functions size and complexity by using internal functions
* internal functions name start with a dot (`.internal()`) and are generally included in the file from the function using it
* try to follow development good practices with `goodpractice::goodpractice()` function from package `goodpractice`

Have a look to already existing code for examples knowing it is not always perfect. When developing you can easily quickly try your new implementation with `devtools::load_all(".")` or `CTRL+SHIFT+L` within Rstudio which will load the package in your environment.

# Documenting

Documenting use the package `Roxygen`. When writting an object place your cursor at the beginning of the object, and in Rstudio go to `Code>Insert Roxygen skeleton` or use `CTRL+ALT+SHIFT+R`. Roxygen code is a special comment starting with `#'`. More information are available in [Whickam book](http://r-pkgs.had.co.nz/man.html). Principle things to fill are listed below:

* Dependance to other package functions with `@include`
* Imports used functions from other packages with `@import` or `@importFrom` (prefer `@importFrom` which import only the function and not the whole package for a smaller environment)
* Object name
* Object description
* Objects parameters or attributes with `@param`
* What the object return with `@return`
* An example of the object use with `@examples`
* Reference to similar or associated functions with `@seealso`
* And finally export the object to user with `@export`

Additionally you can put:

* details with `@details`
* references with `@references`
* and additional section with `@section`

You do not only need to document functions but:

* functions
* class
* methods
* data
* and eventually the package itself

The package documentation skeleton has been already set in `R/RconTROLL.R`, feel free too complete while coding/documenting.

# Formal testing

Formal testing use the package `testthat` and has been already setup in `RconTROLL`. A dummy example on how to write a test is given in `tests/testhat/test_example.R`. It basically consist in giving instructions and an expected result. Test unit should be small and include as deep as possible in the code (not always a whole function, can be an internal). More information are available in [Whickam book](http://r-pkgs.had.co.nz/tests.html). Note that examples writting in documentation are also used as tests (see [Documenting]). To do testing use `devtools::test()` or `CTR+SHIFT+T` in Rstudio. Note that checking (both in Rstudio or continuous integration) are also testing the package with formal testing (see [Checking]).

# Checking

As long as you develop you should check that you are not doing mistakes with all previous indicated tools. In addition, to be sure to have a working package in agreement with CRAN policies for publication you should use the formal check within Rstudio `Build>Check` or `CTRL+SHIFT+E`. Note that this formal check will be done by continuous integration inside GitHub with `Travis-CI` and `Appveyor` (see [Social coding with GitHub]).


# Version tracking

`RconTROLL` comes with version tracking with `git` software (see the [git simple guide](http://rogerdudler.github.io/git-guide/)). `git` is already setup you just have to check its installation on your local machine. And you will find a graphical user interface to use it inside Rstduio itself. When you think that you reached a step in your development you can *save* it by making a new development version. To do that review you change in git user interface by validating them checking the box. Then use the `commit` button. Add a message and commit. I recommand the message to start with the version, i.e. `RconTROLL 0.1.9010` and to give a short information on the new implementations. In parrallel update the `NEWS.md` file by opening a new header with the new version, i.e. `# RconTROLL 0.1.9010`, and list your changes with stars, i.e. `* I made this`.

# Social coding with GitHub

* push
* pull
* checkout remote
* continuous integration
* issues
* project
* fork
* branches
* pull requests
* cross-referencing

# Conclusion

I hope those guidelines will help you in further development of your projects inside `RconTROLL`.

Have a nice development ;)